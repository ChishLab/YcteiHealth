<div align="center"> 
<h1 align="center">
ğŸŒˆYCGYå¥åº·æ‰“å¡
</h1>

![](https://img.shields.io/github/stars/ChishFoxcat/YcteiHealth?style=social "Staræ•°é‡")
![](https://img.shields.io/github/forks/ChishFoxcat/YcteiHealth?style=social "Forkæ•°é‡")
[![LICENSE](https://img.shields.io/github/license/mashape/apistatus.svg?style=flat-square&logo=github&label=LICENSE)](https://github.com/ChishFoxcat/YcteiHealth/blob/master/LICENSE "License")
[![Releases](https://img.shields.io/github/v/release/ChishFoxcat/YcteiHealth?style=flat-square)](https://github.com/ChishFoxcat/YcteiHealth/releases "Release")

</div>

<h1 align="center">

[![Source](https://img.shields.io/badge/Source%20by-Github%20Pages%20Go%E2%86%92-gray.svg?colorA=424242&colorB=4CAF50&style=for-the-badge)](https://github.com/ReaJason/17wanxiaoCheckin)

</h1>

## âš ï¸å£°æ˜

* ä»…ç”¨äºæ—¥å¸¸å¥åº·æ‰“å¡,ç¦æ­¢ä½¿ç”¨äºå…¶ä»–ç”¨é€”
* éç›ˆåˆ©é¡¹ç›®,ä¸¥ç¦å€’å–åŠè·å–åˆ©ç›Š,ä»»ä½•è´£ä»»ä¸äºŒæ¬¡ç¼–è¾‘å’ŒåŸä½œè€…æ— å…³

## ğŸ”°é¡¹ç›®åŠŸèƒ½

* [x] å®Œç¾æ ¡å›­æ¨¡æ‹Ÿç™»å½•è·å– token
* [x] è‡ªåŠ¨è·å–ä¸Šæ¬¡æäº¤çš„æ‰“å¡æ•°æ®ï¼Œä¹Ÿå¯é€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹
* [x] æ”¯æŒå¥åº·æ‰“å¡å’Œæ ¡å†…æ‰“å¡
* [x] å•äººè‡ªå®šä¹‰æ¨é€ï¼Œå¯ç»Ÿä¸€æ¨é€
* [x] æ”¯æŒç²®ç¥¨ç­¾åˆ°æ”¶é›†ï¼Œè‡ªåŠ¨å®ŒæˆæŸ¥çœ‹è¯¾è¡¨å’Œæ ¡å›­å¤´æ¡ä»»åŠ¡
* [x] æ”¯æŒé‚®ç®±ã€Qmsgã€Server é…±ã€PipeHub æ¨é€æ‰“å¡æ¶ˆæ¯

## ğŸ¨é…ç½®æ–‡ä»¶

### ğŸ’ƒç”¨æˆ·é…ç½®

- æ‰“å¡ç”¨æˆ·é…ç½®æ–‡ä»¶ä½äºï¼š`conf/user.json`
- æ•´ä¸ª json æ–‡ä»¶ä½¿ç”¨ä¸€ä¸ª `[]` åˆ—è¡¨ç”¨æ¥å­˜å‚¨æ‰“å¡ç”¨æˆ·æ•°æ®ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·å æ®äº†ä¸€ä¸ª `{}`é”®å€¼å¯¹ï¼Œåˆæ¬¡ä¿®æ”¹åŠ¡å¿…å¡«å†™çš„æ•°æ®ä¸ºï¼š`phone`ã€`password`ã€`device_id`ã€å¥åº·æ‰“å¡çš„å¼€å…³ï¼Œæ ¡å†…æ‰“å¡å¼€å…³ï¼ˆæœ‰åˆ™å¼€ï¼‰ï¼Œæ¨é€è®¾ç½® `push`ã€‚
- å…³äº `post_json`ï¼Œå¦‚è‹¥æ‰“å¡æ¨é€æ•°æ®ä¸­æ— é”™è¯¯ï¼Œåˆ™ä¸ç”¨ç®¡ï¼Œè‹¥æœ‰ nullï¼Œæˆ–å…¶ä»–è·å–ä¸åˆ°çš„æƒ…å†µï¼Œåˆ™é…Œæƒ…ä¿®æ”¹å³å¯ï¼Œå’Œæ¨é€æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚

è®¾å¤‡idè®¤è¯è½¯ä»¶ï¼š[ç‚¹æˆ‘ä¸‹è½½]()
ï¼ˆæ ¹æ®æˆªå›¾åˆ¤æ–­è‡ªå·±å±äºå“ªä¸€ç±»[ã€1ã€‘](https://cdn.jsdelivr.net/gh/ReaJason/17wanxiaoCheckin/Pictures/one.png)ã€[ã€2ã€‘](https://cdn.jsdelivr.net/gh/ReaJason/17wanxiaoCheckin/Pictures/two.png)ï¼‰

### ğŸ¤ç»Ÿä¸€æ¨é€é…ç½®

- ç»Ÿä¸€æ¨é€é…ç½®æ–‡ä»¶ä½äºï¼š`conf/push.json`
- è‹¥å¤šç”¨æˆ·æ‰“å¡ä½¿ç”¨ç»Ÿä¸€æ¨é€è€Œä¸æ˜¯ä¸ªåˆ«å•ç‹¬æ¨é€åˆ™åœ¨æ­¤æ–‡ä»¶ä¸‹è¿›è¡Œæ¨é€çš„é…ç½®




- ç¬¬ä¸€ç±»å¥åº·æ‰“å¡æˆåŠŸç»“æœï¼š`{'msg': 'æˆåŠŸ', 'code': '10000', 'data': 1}`ï¼Œæ˜¾ç¤ºæ‰“å¡é¢‘ç¹ä¹Ÿç®—

- ç¬¬äºŒç±»å¥åº·æ‰“å¡æˆåŠŸç»“æœï¼š`{'code': 0, 'msg': 'æˆåŠŸ'}`

- æ ¡å†…æ‰“å¡æˆåŠŸç»“æœï¼š`{'msg': 'æˆåŠŸ', 'code': '10000', 'data': 1}`

- å¦‚æœä½ ä»¬å­¦æ ¡ä¼šè®°å½•æ‰“å¡æˆåŠŸä¸å¦å¯ç›´æ¥åœ¨ **æ”¯ä»˜å®å°ç¨‹åº** æŸ¥çœ‹æ˜¯å¦è®°å½•ä¸Šå»ï¼ˆæ‰‹æœº app ç™»å½•çš„è¯ä¹‹å‰è·å–çš„ device_id å°±å¤±æ•ˆäº†ï¼‰

- æœ€åæ£€æŸ¥æ¨é€æ•°æ®ï¼Œå¦‚æœè¡¨æ ¼ä¸­æœ‰ Noneï¼Œè¯·æ ¹æ®ç¬¬äºŒè¡Œçš„ä¿¡æ¯ï¼Œæ­é…ç¬¬ä¸€è¡Œæ¨é€ä¿¡æ¯çš„æ ¼å¼ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶

  - æ‰“å¼€ç¬¬ä¸€è¡Œï¼Œæ‰¾åˆ° updatainfo è¿™ä¸ªä¸œè¥¿ï¼Œä¸‹é¢çš„æœ‰ null çš„å¯¹åº”å°±æ˜¯è¡¨æ ¼ä¸­çš„ Noneï¼Œè®°ä½å®ƒçš„ propertyname

  - æ‰“å¼€ç¬¬äºŒè¡Œï¼Œæ‰¾åˆ°å¯¹åº” perpertyname çš„éƒ¨åˆ†ï¼Œæ ¹æ® checkValue çš„ text é€‰æ‹©ä½ éœ€è¦çš„é€‰é¡¹ï¼Œæ¸©åº¦è‡ªå·±å¡«ä¸ªå€¼å°±å¯

  - æ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ° post_json ä¸‹çš„ updatainfoï¼Œåœ¨é‡Œé¢åŠ å…¥ä½ éœ€è¦ä¿®æ”¹çš„å€¼ï¼Œæ ¼å¼å’Œç¬¬ä¸€è¡Œé‡Œé¢çš„æ‰“å¡æ•°æ®ä¸€æ ·

  - ```
    "updatainfo":[
    	{
        	"propertyname": "temperature",  // è¿™ä¸ªä¸ºç¬¬ä¸€è¡Œä¸­æ‰¾åˆ°å€¼ä¸º null çš„é‚£ä¸€é¡¹
            "value": "35.7"  // è¿™ä¸ªå€¼ä¸ºä½ æƒ³æ”¹çš„å€¼ï¼Œç¬¬äºŒè¡Œä¸­è·å–ï¼Œå¦‚æœæ˜¯æ¸©åº¦ï¼Œè‡ªå·±å¡«è‡ªå·±æƒ³çš„å³å¯
        },
        {
        	"propertyname": "wengdu",
        	"value": "36.4"
        }
    ]
    ```

     

- ç”±äºå‰é¢ä½¿ç”¨è½¯ä»¶è·å–äº† device_idï¼Œæ‰€ä»¥è¯·ä½¿ç”¨ **æ”¯ä»˜å®å°ç¨‹åº** æŸ¥çœ‹æ‰“å¡ç»“æœæ˜¯å¦è®°å½•ä¸Šå»ï¼Œä»¥å…æ‰‹æœºç™»å½• device_id å¤±æ•ˆ


## Crontab å®šæ—¶ä»»åŠ¡
1. é¦–å…ˆåœ¨å‘½ä»¤è¡Œæ‰§è¡Œ `crontab -e` æ‰“å¼€ crontab çš„é…ç½®æ–‡ä»¶
2. ç„¶åæŒ‰ `i` è¿›è¡Œç¼–è¾‘
3. åœ¨ crontab çš„é…ç½®æ–‡ä»¶ä¸­çš„æ–°ä¸€è¡Œè¾“å…¥ `0 5 * * * /home/YcteiHealth/health.sh > /dev/null 2>&1` è¿™ä¸€å¥

> - `0 5 * * *` æ˜¯æŒ‡ 0 åˆ†é’Ÿ 5 æ—¶ æ¯å¤© æ¯æœˆ æ¯æ—¥
> - `/home/YcteiHealth/health.sh` æ˜¯å®šæ—¶æ‰§è¡Œæ‰€éœ€è„šæœ¬
> - `> /dev/null 2>&1` æ˜¯ç¦æ­¢ç³»ç»Ÿåœ¨æ‰§è¡Œå®Œå‘½ä»¤ååœ¨ /tmp æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºæ—¥å¿—æ–‡ä»¶è®°å½•æ‰§è¡ŒçŠ¶å†µ

## è„šæœ¬ç¯‡ (health.sh)
1. å‰å¾€ç­¾åˆ°è„šæœ¬æ‰€åœ¨ç›®å½• `cd /home/YcteiHealth`
2. åœ¨è„šæœ¬ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸º `health.sh` çš„ .sh è„šæœ¬
3. åœ¨è„šæœ¬å¼€å¤´å†™ä¸ª bash æ–‡ä»¶å¤´ï¼ŒæŒ‡å®šè„šæœ¬ç±»å‹ `!#/bin/bash`
4. åœ¨è„šæœ¬ `health.sh` çš„æ–°çš„ä¸€è¡Œä¸­å†™ `screen -dmS YcteiHealth /bin/bash -c "cd /home/YcteiHealth;python index.py;exec /bin/bash"`
5. ä¿å­˜ï¼

> - `screen -dmS YcteiHealth /bin/bash` åˆ›å»ºä¸€ä¸ªåä¸º YcteiHealth çš„ screen å®ˆæŠ¤è¿›ç¨‹ï¼Œç±»å‹ä¸º bash å‘½ä»¤è¡Œ
> - `-c` æ‰§è¡Œå‘½ä»¤
> - `"cd /home/YcteiHealth;python index.py;exec /bin/bash"` /tp åˆ°æ‰“å¡è„šæœ¬çš„ç›®å½•ä¸‹ï¼Œç”¨ python è¿è¡Œåä¸º index.py çš„ python è„šæœ¬ï¼Œæœ€åå†æ‰§è¡Œè¿è¡Œ /bin/bash æ¥ä¿è¯è„šæœ¬è¿è¡Œå®Œèƒ½æ¢å¤ä¼šè¯æŸ¥çœ‹æ‰§è¡Œç»“æœã€‚ï¼ˆå‘½ä»¤é—´ç”¨ ; éš”å¼€ï¼‰

## å®å¡”å®šæ—¶ä»»åŠ¡å‡ºç°çš„é—®é¢˜
- **æŸ¥çœ‹æ–‡ç« å¤±è´¥çš„é”™è¯¯**
> å®å¡”çš„å®šæ—¶ä»»åŠ¡å…¶å®ä¹Ÿæ˜¯ä½¿ç”¨ç³»ç»Ÿçš„ `crontab` æ¥æ‰§è¡Œï¼Œä½†ç›´æ¥åœ¨è„šæœ¬å†…å®¹ä¸­ cd åˆ°ç›®å½•å†æ‰§è¡Œè„šæœ¬å¯èƒ½ä¼šå‡ºç°è«åå…¶å¦™çš„è¯»å–ä¸åˆ°é…ç½®æ–‡ä»¶çš„é”™è¯¯ï¼ˆä¸åœ¨è·¯ç”±å™¨ä¸Šç”¨ screen cd åˆ° frpc ç›®å½•ä½†æ˜¯æ‰¾ä¸åˆ°ç›®å½•çš„é—®é¢˜ç±»ä¼¼ï¼‰

## ğŸ™‹â€è„šæœ¬æœ‰é—®é¢˜
* æœ‰é—®é¢˜å¯æ [issue](https://github.com/ChishFoxcat/YcteiHealth/issues)

## ğŸ“œFQA

- è‹¥ç¬¬ä¸€ç±»å¥åº·æ‰“å¡æˆ–æ ¡å†…å¤§å¡æ‰“å¡æ¨é€æ˜¾ç¤ºï¼Œéœ€è¦ä¿®æ”¹å¯¹åº”ä½ç½®ä¸‹çš„ areaStrï¼Œä¿®æ”¹æ ¼å¼ä¸ºï¼š`"areaStr": "{\"address\":\"å¤©å¿ƒåŒºé’å›­è·¯251å·ä¸­å—æ—ä¸šç§‘æŠ€å¤§å­¦\",\"text\":\"æ¹–å—çœ-é•¿æ²™å¸‚-å¤©å¿ƒåŒº\",\"code\":\"\"}"` ï¼Œ`address`ï¼šå¯¹åº”æ‰‹æœºæ‰“å¡ç•Œé¢çš„ä¸‹é¢ä¸€è¡Œï¼Œ`text`ï¼šå¯¹åº”æ‰‹æœºæ‰“å¡ç•Œé¢çš„ä¸Šé¢ä¸€è¡Œï¼Œæ ¹æ®è‡ªå·±çš„æ¥ï¼Œä¸Šé¢å¡«ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆï¼Œè‹¥æ˜¯æ ¡å†…æ‰“å¡çš„åœ°å€è·å–ä¸åˆ°ï¼Œå¯æŸ¥çœ‹å¥åº·æ‰“å¡çš„æ‰“å¡æ•°æ®æ¨é€é‡Œé¢çš„ areaStr å¤åˆ¶å³å¯ã€‚
- è‹¥æ‰“å¡ç»“æœä¸º `{'msg': 'å‚æ•°ä¸åˆæ³•', 'code': '10002', 'data': ;'deptid can not be null'}`ï¼Œåˆæ­¥è®¤ä¸ºä½ ä»¬å­¦æ ¡æ‰“å¡æ•°æ®æ— æ³•è‡ªåŠ¨è·å–ï¼Œæ¯æ¬¡éœ€è¦è‡ªå·±å¡«å†™æ•°æ®ï¼Œè§£å†³åŠæ³•ä¸ºæ‰‹æœºç™»å½•æ‰“å¡æŠ“ç­¾åˆ°åŒ…ï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶çš„ `post_json` ä¸­å¡«ä¸‹ä½ çš„æ‰“å¡æ•°æ®ã€‚


### **[è¯¦æƒ…ç‚¹å‡»æˆ‘è·³è½¬åˆ°æºé¡¹ç›®æŸ¥çœ‹MarkDown](https://github.com/ReaJason/17wanxiaoCheckin)**
